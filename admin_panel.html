<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AdLancer - Admin Panel</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #121826;
      --bg-secondary: #1a202c;
      --bg-tertiary: #2d3748;
      --bg-card: #1e293b;
      --accent-primary: #7e57c2;
      --accent-secondary: #5e35b1;
      --text-primary: #e2e8f0;
      --text-secondary: #a0aec0;
      --text-tertiary: #718096;
      --success: #38a169;
      --warning: #d69e2e;
      --error: #e53e3e;
      --border-radius: 8px;
      --border-radius-sm: 6px;
      --border-radius-lg: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.2);
      --sidebar-width: 280px;
      --header-height: 60px;
    }

    body.light-mode {
      --bg-primary: #f8fafc;
      --bg-secondary: #e2e8f0;
      --bg-tertiary: #cbd5e1;
      --bg-card: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --text-tertiary: #64748b;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      transition: var(--transition);
      line-height: 1.5;
    }

    /* Admin Layout */
    .admin-container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .admin-sidebar {
      width: var(--sidebar-width);
      background: var(--bg-card);
      border-right: 1px solid var(--bg-tertiary);
      padding: 20px 0;
      height: 100vh;
      position: sticky;
      top: 0;
      overflow-y: auto;
      transition: var(--transition);
      z-index: 1000;
    }

    .admin-logo {
      padding: 0 20px 20px;
      border-bottom: 1px solid var(--bg-tertiary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 1.2rem;
      color: var(--accent-primary);
    }

    .admin-nav {
      list-style: none;
      padding: 0 10px;
    }

    .nav-item {
      margin-bottom: 5px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      border-radius: var(--border-radius);
      color: var(--text-secondary);
      text-decoration: none;
      transition: var(--transition);
    }

    .nav-link:hover,
    .nav-link.active {
      background: rgba(126, 87, 194, 0.1);
      color: var(--accent-primary);
    }

    .nav-link i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }

    /* Main Content */
    .admin-main {
      flex: 1;
      padding: 20px;
      transition: var(--transition);
    }

    .admin-header {
      background: var(--bg-card);
      border-radius: var(--border-radius);
      padding: 15px 20px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--bg-tertiary);
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .theme-toggle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--bg-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      font-size: 1.1rem;
      cursor: pointer;
      transition: var(--transition);
      border: none;
    }

    .theme-toggle:hover {
      background: var(--bg-tertiary);
      color: var(--accent-primary);
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: var(--bg-card);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--bg-tertiary);
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(126, 87, 194, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent-primary);
      font-size: 1.5rem;
      margin-bottom: 15px;
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* Content Cards */
    .content-card {
      background: var(--bg-card);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--bg-tertiary);
    }

    /* Dashboard charts grid */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 992px) {
      .charts-grid { grid-template-columns: 1fr; }
    }

    .chart-card {
      background: var(--bg-card);
      border-radius: var(--border-radius);
      padding: 16px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--bg-tertiary);
      overflow: hidden;
    }

    .chart-title {
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 10px;
      font-size: 0.95rem;
    }

    .chart-wrapper { position: relative; height: 300px; }
    .chart-canvas { width: 100% !important; height: 100% !important; display: block; }

    /* Bottom Navigation (mobile) */
    .bottom-nav {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      width: calc(100% - 32px);
      max-width: 960px;
      background: var(--bg-card);
      border: 1px solid var(--bg-tertiary);
      border-radius: 16px;
      box-shadow: var(--shadow);
      z-index: 1000;
      padding: 8px 10px;
      backdrop-filter: blur(6px);
      display: none;
    }
    .bottom-nav .nav-list { display: flex; align-items: center; justify-content: space-between; list-style: none; gap: 6px; }
    .bottom-nav .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px 6px; text-decoration: none; color: var(--text-primary); border-radius: 12px; transition: var(--transition); }
    .bottom-nav .nav-item .nav-icon { margin: 0 0 6px 0; font-size: 1.2rem; }
    .bottom-nav .nav-item .nav-label { font-size: 0.75rem; font-weight: 600; }
    .bottom-nav .nav-item.active { background: rgba(126, 87, 194, 0.1); color: var(--accent-primary); }
    .bottom-nav .nav-item:hover:not(.active) { background: var(--bg-secondary); }

    /* Entrance animations */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-in { opacity: 0; transform: translateY(10px); }
    .animate-in.show { animation: fadeUp 0.5s ease forwards; }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--bg-tertiary);
    }

    .card-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .card-actions {
      display: flex;
      gap: 10px;
    }

    /* Tables */
    .table-responsive {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      border-radius: var(--border-radius-sm);
      border: 1px solid var(--bg-tertiary);
    }

    /* Better mobile visibility for users table */
    @media (max-width: 480px) {
      .users-table { min-width: 100%; }
      .users-table th, .users-table td { white-space: normal; }
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
      /* Ensure minimum width for proper display */
    }

    .admin-table th,
    .admin-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--bg-tertiary);
      white-space: nowrap;
      /* Prevent text wrapping */
    }

    /* Compact columns for space-saving */
    .col-ads { width: 80px; text-align: right; }
    .col-actions { width: 50px; text-align: center; }
    .col-name { max-width: 180px; }

    @media (max-width: 768px) {
      .col-ads { width: 64px; }
      .col-actions { width: 44px; }
      .col-name { max-width: 130px; }
    }

    /* Name truncation with ellipsis */
    .name-cell {
      display: inline-block;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      vertical-align: bottom;
      cursor: pointer;
    }

    /* Three-dot (kebab) menu */
    .kebab-wrapper { position: relative; display: inline-flex; }
    .kebab-btn {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 6px 8px;
      border-radius: 6px;
    }
    .kebab-btn:hover { background: var(--bg-secondary); color: var(--text-primary); }
    .kebab-menu {
      position: absolute;
      right: 0;
      top: 100%;
      margin-top: 6px;
      background: var(--bg-card);
      border: 1px solid var(--bg-tertiary);
      border-radius: 8px;
      box-shadow: var(--shadow-sm);
      display: none;
      min-width: 140px;
      z-index: 2001;
      overflow: hidden;
    }
    .kebab-menu.show { display: block; }
    .kebab-item { display: block; width: 100%; text-align: left; padding: 10px 12px; background: transparent; border: none; color: var(--text-primary); cursor: pointer; font-size: 0.9rem; }
    .kebab-item:hover { background: var(--bg-secondary); }

    /* Simple name popup */
    .name-popup {
      position: fixed;
      background: var(--bg-card);
      color: var(--text-primary);
      border: 1px solid var(--bg-tertiary);
      border-radius: 8px;
      padding: 8px 10px;
      box-shadow: var(--shadow);
      z-index: 3000;
      max-width: 80vw;
      font-size: 0.9rem;
    }

    .admin-table th {
      background: var(--bg-secondary);
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 0.9rem;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .admin-table tr:hover {
      background: var(--bg-secondary);
    }

    /* Mobile table optimizations */
    @media (max-width: 768px) {
      .admin-table {
        min-width: 500px;
        font-size: 0.8rem;
      }

      .admin-table th,
      .admin-table td {
        padding: 8px 10px;
      }
    }

    @media (max-width: 480px) {
      .admin-table {
        min-width: 400px;
        font-size: 0.75rem;
      }

      .admin-table th,
      .admin-table td {
        padding: 6px 8px;
      }
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 16px;
      border-radius: var(--border-radius-sm);
      border: none;
      font-weight: 500;
      font-size: 0.9rem;
      cursor: pointer;
      transition: var(--transition);
      gap: 5px;
    }

    .btn-sm {
      padding: 5px 10px;
      font-size: 0.8rem;
    }

    .btn-primary {
      background: var(--accent-primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent-secondary);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #2f855a;
    }

    .btn-danger {
      background: var(--error);
      color: white;
    }

    .btn-danger:hover {
      background: #c53030;
    }

    .btn-warning {
      background: var(--warning);
      color: white;
    }

    .btn-warning:hover {
      background: #b7791f;
    }

    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background: var(--bg-tertiary);
    }

    /* Badges */
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-success {
      background: rgba(56, 161, 105, 0.1);
      color: var(--success);
    }

    .badge-warning {
      background: rgba(214, 158, 46, 0.1);
      color: var(--warning);
    }

    .badge-danger {
      background: rgba(229, 62, 62, 0.1);
      color: var(--error);
    }

    .badge-info {
      background: rgba(66, 153, 225, 0.1);
      color: #4299e1;
    }

    /* Forms */
    .form-group {
      margin-bottom: 15px;
    }

    .form-label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .form-control {
      width: 100%;
      padding: 10px 12px;
      border-radius: var(--border-radius-sm);
      border: 1px solid var(--bg-tertiary);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 0.9rem;
      transition: var(--transition);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(126, 87, 194, 0.2);
    }

    /* Search Box */
    .search-box {
      display: flex;
      margin-bottom: 20px;
    }

    .search-input {
      flex: 1;
      padding: 10px 15px;
      border-radius: var(--border-radius-sm) 0 0 var(--border-radius-sm);
      border: 1px solid var(--bg-tertiary);
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .search-btn {
      padding: 10px 15px;
      background: var(--accent-primary);
      color: white;
      border: none;
      border-radius: 0 var(--border-radius-sm) var(--border-radius-sm) 0;
      cursor: pointer;
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 5px;
    }

    .page-item {
      display: inline-flex;
    }

    .page-link {
      padding: 8px 12px;
      border-radius: var(--border-radius-sm);
      border: 1px solid var(--bg-tertiary);
      background: var(--bg-card);
      color: var(--text-primary);
      text-decoration: none;
      transition: var(--transition);
    }

    .page-link:hover {
      background: var(--accent-primary);
      color: white;
      border-color: var(--accent-primary);
    }

    .page-item.active .page-link {
      background: var(--accent-primary);
      color: white;
      border-color: var(--accent-primary);
    }

    /* Login Page */
    .login-container {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: var(--bg-secondary);
    }

    .login-card {
      background: var(--bg-card);
      border-radius: var(--border-radius);
      padding: 30px;
      width: 100%;
      max-width: 400px;
      box-shadow: var(--shadow);
      border: 1px solid var(--bg-tertiary);
    }

    .login-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .login-logo {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--accent-primary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .login-title {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }

    .login-subtitle {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--bg-card);
      color: var(--text-primary);
      padding: 12px 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      z-index: 1000;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .toast-success {
      border-left: 4px solid var(--success);
    }

    .toast-error {
      border-left: 4px solid var(--error);
    }

    .toast-warning {
      border-left: 4px solid var(--warning);
    }

    /* Chart container */
    .chart-container {
      height: 300px;
      margin-top: 20px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--bg-tertiary);
      margin-bottom: 20px;
    }

    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: var(--transition);
    }

    .tab.active {
      border-bottom-color: var(--accent-primary);
      color: var(--accent-primary);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* User Details Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.show {
      opacity: 1;
      pointer-events: all;
    }

    .modal {
      background: var(--bg-card);
      border-radius: var(--border-radius);
      padding: 20px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      transform: scale(0.9);
      transition: transform 0.3s ease;
      box-shadow: var(--shadow);
      border: 1px solid var(--bg-tertiary);
    }

    .modal-overlay.show .modal {
      transform: scale(1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--bg-tertiary);
    }

    .modal-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: var(--transition);
    }

    .modal-close:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .user-details {
      display: grid;
      gap: 15px;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid var(--bg-tertiary);
    }

    .detail-row:last-child {
      border-bottom: none;
    }

    .detail-label {
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .detail-value {
      color: var(--text-primary);
      font-size: 0.9rem;
    }

    .user-avatar-large {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin: 0 auto 15px;
      display: block;
      border: 3px solid var(--accent-primary);
    }

    /* Center name row nicely on mobile in modal */
    @media (max-width: 768px) {
      .user-details .detail-row.name-row { justify-content: center; text-align: center; }
    }

    .user-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin: 20px 0;
    }

    .user-stat-card {
      background: var(--bg-secondary);
      padding: 15px;
      border-radius: var(--border-radius-sm);
      text-align: center;
      border: 1px solid var(--bg-tertiary);
    }

    .user-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-primary);
      margin-bottom: 5px;
    }

    .user-stat-label {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* Withdrawal Tab Content */
    .withdrawal-tab-content {
      display: none;
    }

    .withdrawal-tab-content.active {
      display: block;
    }

    /* Mobile Navigation Button */
    .mobile-menu-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(126, 87, 194, 0.4);
      transition: all 0.3s ease;
      border: none;
    }

    .mobile-menu-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(126, 87, 194, 0.5);
    }

    .mobile-menu-button.active {
      transform: rotate(45deg);
    }

    /* Mobile-First Responsive Design */
    @media (max-width: 1200px) {
      .admin-sidebar {
        width: 250px;
      }
    }

    @media (max-width: 992px) {
      .admin-sidebar {
        width: 70px;
        overflow: visible;
      }

      .nav-link span {
        display: none;
      }

      .admin-logo span {
        display: none;
      }

      .admin-logo {
        justify-content: center;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .admin-container {
        flex-direction: column;
      }

      .admin-sidebar { display: none; }

      .admin-nav {
        display: block;
        padding: 0 10px;
      }

      .nav-item {
        margin-bottom: 5px;
        min-width: auto;
      }

      .nav-link span {
        display: inline;
      }

      .nav-link {
        padding: 12px 15px;
        font-size: 1rem;
      }

      .admin-main {
        padding: 15px;
        width: 100%;
      }

      .admin-header {
        padding: 12px 15px;
        margin-bottom: 15px;
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }

      .header-actions {
        width: 100%;
        justify-content: space-between;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 15px;
      }

      .stat-card {
        padding: 15px;
      }

      .content-card {
        padding: 15px;
        margin-bottom: 15px;
      }


      .btn {
        padding: 6px 12px;
        font-size: 0.8rem;
      }

      .btn-sm {
        padding: 4px 8px;
        font-size: 0.75rem;
      }

      .mobile-menu-button { display: none !important; }
      .bottom-nav { display: block; }
      .admin-main { padding-bottom: calc(140px + env(safe-area-inset-bottom)); }
      .tab-content { padding-bottom: 120px; }
    }

    /* Extra-compact bottom nav on very small screens */
    @media (max-width: 400px) {
      .bottom-nav { width: calc(100% - 16px); }
      .bottom-nav .nav-item { padding: 10px 4px; }
      .bottom-nav .nav-item .nav-label { display: none; }
      .bottom-nav .nav-item .nav-icon { font-size: 1.25rem; }
    }

    @media (max-width: 480px) {
      .admin-main {
        padding: 10px;
      }

      .admin-header {
        padding: 10px 12px;
        margin-bottom: 10px;
      }

      .page-title {
        font-size: 1.2rem;
      }

      .stats-grid {
        gap: 10px;
        margin-bottom: 10px;
      }

      .stat-card {
        padding: 12px;
      }

      .stat-value {
        font-size: 1.5rem;
      }

      .content-card {
        padding: 12px;
        margin-bottom: 10px;
      }

      .card-title {
        font-size: 1rem;
      }


      .form-control {
        padding: 8px 10px;
        font-size: 0.85rem;
      }

      .search-input {
        padding: 8px 10px;
        font-size: 0.85rem;
      }

      .search-btn {
        padding: 8px 10px;
      }

      .pagination {
        flex-wrap: wrap;
        gap: 3px;
      }

      .page-link {
        padding: 6px 8px;
        font-size: 0.75rem;
      }

      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .card-actions {
        width: 100%;
        justify-content: space-between;
      }

      .search-box {
        width: 100%;
      }
    }

    /* Mobile Modal Adjustments */
    @media (max-width: 768px) {
      .modal {
        width: 95%;
        padding: 15px;
        margin: 10px;
      }

      .modal-title {
        font-size: 1.1rem;
      }

      .user-stats-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
      .user-stat-card { padding: 10px; }
      .user-stat-value { font-size: 1.2rem; }
      .user-stat-label { font-size: 0.75rem; }

      .detail-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
      }

      .detail-label {
        font-size: 0.8rem;
      }

      .detail-value {
        font-size: 0.85rem;
      }
    }
  </style>
</head>

<body class="dark-mode">
  <!-- Login Screen (initially visible) -->
  <div id="loginScreen" class="login-container">
    <div class="login-card">
      <div class="login-header">
        <div class="login-logo">
          <i class="fas fa-coins"></i>
          <span>AdLancer</span>
        </div>
        <h2 class="login-title">Admin Panel</h2>
        <p class="login-subtitle">Sign in to access the dashboard</p>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label class="form-label">Username</label>
          <input type="text" class="form-control" id="username" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-control" id="password" required>
        </div>
        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
          <i class="fas fa-sign-in-alt"></i> Sign In
        </button>
      </form>
    </div>
  </div>

  <!-- Admin Panel (initially hidden) -->
  <div id="adminPanel" class="admin-container" style="display: none;">
    <!-- Sidebar -->
    <div class="admin-sidebar" id="adminSidebar">
      <div class="admin-logo">
        <i class="fas fa-coins"></i>
        <span>AdLancer Admin</span>
      </div>
      <ul class="admin-nav">
        <li class="nav-item">
          <a href="#" class="nav-link active" data-tab="dashboard">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-tab="users">
            <i class="fas fa-users"></i>
            <span>Users</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-tab="withdrawals">
            <i class="fas fa-money-bill-wave"></i>
            <span>Withdrawals</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-tab="referrals">
            <i class="fas fa-user-friends"></i>
            <span>Referrals</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" data-tab="settings">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="#" class="nav-link" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="admin-main">
      <div class="admin-header">
        <h1 class="page-title" id="pageTitle">Dashboard</h1>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" id="refreshDataBtn" title="Refresh Data">
            <i class="fas fa-sync-alt"></i>
          </button>
          <button class="theme-toggle" id="themeToggle">
            <i class="fas fa-sun"></i>
          </button>
          <button class="btn btn-danger btn-sm" id="headerLogoutBtn" title="Logout">
            <i class="fas fa-sign-out-alt"></i>
          </button>
        </div>
      </div>

      <!-- Dashboard Tab -->
      <div id="dashboardTab" class="tab-content active">
        <div class="dashboard-row">
          <div>
            <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-value" id="totalUsers">0</div>
            <div class="stat-label">Total Users</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-coins"></i>
            </div>
            <div class="stat-value" id="totalPoints">0</div>
            <div class="stat-label">Total Points</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-ad"></i>
            </div>
            <div class="stat-value" id="totalAds">0</div>
            <div class="stat-label">Ads Watched</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="stat-value" id="pendingWithdrawals">0</div>
            <div class="stat-label">Pending Withdrawals</div>
          </div>
            </div>
          </div>
          <div>
            <div class="charts-grid">
              <div class="chart-card animate-in">
                <div class="chart-title">All Users Activity</div>
                <div class="chart-wrapper"><canvas id="allUsersChart" class="chart-canvas"></canvas></div>
              </div>
              <div class="chart-card animate-in">
                <div class="chart-title">Referral Activity</div>
                <div class="chart-wrapper"><canvas id="referralChart" class="chart-canvas"></canvas></div>
              </div>
            </div>
          </div>
        </div>

        <div class="content-card">
          <div class="card-header">
            <h2 class="card-title">Recent Activity</h2>
          </div>
          <div class="table-responsive">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Action</th>
                  <th>Details</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody id="recentActivityTable">
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        

        <div class="content-card">
          <div class="card-header">
            <h2 class="card-title">Top Users</h2>
          </div>
          <div class="table-responsive">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Rank</th>
                  <th class="col-name">User</th>
                  <th>Points</th>
                  <th class="col-ads" title="Ads Watched">Ads W.</th>
                  <th>Referrals</th>
                </tr>
              </thead>
              <tbody id="topUsersTable">
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Users Tab -->
      <div id="usersTab" class="tab-content">
        <div class="content-card">
          <div class="card-header">
            <h2 class="card-title">User Management</h2>
            <div class="card-actions">
              <div class="search-box">
                <input type="text" class="search-input" id="userSearch" placeholder="Search users...">
                <button class="search-btn">
                  <i class="fas fa-search"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="table-responsive">
            <table class="admin-table users-table">
              <thead>
                <tr>
                  <th class="col-name">Name</th>
                  <th>Points</th>
                  <th class="col-ads" title="Ads Watched">Ads W.</th>
                  <th>Status</th>
                  <th class="col-actions">Actions</th>
                </tr>
              </thead>
              <tbody id="usersTable">
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
          <div class="pagination" id="usersPagination">
            <!-- Will be populated by JavaScript -->
          </div>
        </div>
      </div>

      <!-- Withdrawals Tab -->
      <div id="withdrawalsTab" class="tab-content">
        <div class="tabs">
          <div class="tab active" data-withdrawal-tab="pending">Pending</div>
          <div class="tab" data-withdrawal-tab="approved">Approved</div>
          <div class="tab" data-withdrawal-tab="rejected">Rejected</div>
        </div>

        <div class="withdrawal-tab-content active" id="pendingWithdrawalsTab">
          <div class="content-card">
            <div class="card-header">
              <h2 class="card-title">Pending Withdrawal Requests</h2>
            </div>
            <div class="table-responsive">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Amount</th>
                    <th>Method</th>
                    <th>Account</th>
                    <th>Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="pendingWithdrawalsTable">
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="withdrawal-tab-content" id="approvedWithdrawalsTab">
          <div class="content-card">
            <div class="card-header">
              <h2 class="card-title">Approved Withdrawals</h2>
            </div>
            <div class="table-responsive">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Amount</th>
                    <th>Method</th>
                    <th>Account</th>
                    <th>Approved Date</th>
                  </tr>
                </thead>
                <tbody id="approvedWithdrawalsTable">
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="withdrawal-tab-content" id="rejectedWithdrawalsTab">
          <div class="content-card">
            <div class="card-header">
              <h2 class="card-title">Rejected Withdrawals</h2>
            </div>
            <div class="table-responsive">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Amount</th>
                    <th>Method</th>
                    <th>Reason</th>
                    <th>Rejected Date</th>
                  </tr>
                </thead>
                <tbody id="rejectedWithdrawalsTable">
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Referrals Tab -->
      <div id="referralsTab" class="tab-content">
        <div class="content-card">
          <div class="card-header">
            <h2 class="card-title">Referral Statistics</h2>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-user-plus"></i>
              </div>
              <div class="stat-value" id="totalReferrals">0</div>
              <div class="stat-label">Total Referrals</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-gift"></i>
              </div>
              <div class="stat-value" id="totalBonusGiven">0</div>
              <div class="stat-label">Bonus Points Given</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="stat-value" id="conversionRate">0%</div>
              <div class="stat-label">Conversion Rate</div>
            </div>
          </div>
        </div>

        <div class="content-card">
          <div class="card-header">
            <h2 class="card-title">Top Referrers</h2>
          </div>
          <div class="table-responsive">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Referrals</th>
                  <th>Bonus Earned</th>
                </tr>
              </thead>
              <tbody id="topReferrersTable">
                <!-- Will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div id="settingsTab" class="tab-content">
        <div class="content-card">
          <div class="card-header">
            <h2 class="card-title">Application Settings</h2>
          </div>
          <form id="appSettingsForm">
            <div class="form-group">
              <label class="form-label">Points per Ad</label>
              <input type="number" class="form-control" id="pointsPerAd" min="1" required>
            </div>
            <div class="form-group">
              <label class="form-label">Daily Ad Limit</label>
              <input type="number" class="form-control" id="dailyAdLimit" min="1" required>
            </div>
            <div class="form-group">
              <label class="form-label">Minimum Withdrawal Points</label>
              <input type="number" class="form-control" id="minWithdrawalPoints" min="1" required>
            </div>
            <div class="form-group">
              <label class="form-label">Referral Bonus (Referrer)</label>
              <input type="number" class="form-control" id="referrerBonus" min="0" required>
            </div>
            <div class="form-group">
              <label class="form-label">Referral Bonus (Referee)</label>
              <input type="number" class="form-control" id="refereeBonus" min="0" required>
            </div>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i> Save Settings
            </button>
          </form>
        </div>

        <div class="content-card">
          <div class="card-header">
            <h2 class="card-title">Danger Zone</h2>
          </div>
          <div class="form-group">
            <button class="btn btn-danger" id="exportDataBtn">
              <i class="fas fa-download"></i> Export All Data
            </button>
          </div>
          <div class="form-group">
            <button class="btn btn-danger" id="resetDataBtn">
              <i class="fas fa-trash"></i> Reset All Data
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-button" id="mobileMenuButton" style="display: none;">
      <i class="fas fa-bars"></i>
    </button>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

  <!-- Bottom Navigation (mobile) -->
  <nav class="bottom-nav" id="bottomNav">
    <ul class="nav-list">
      <li>
        <a href="#" class="nav-item active" data-tab="dashboard">
          <div class="nav-icon"><i class="fas fa-tachometer-alt"></i></div>
          <div class="nav-label">Dashboard</div>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item" data-tab="users">
          <div class="nav-icon"><i class="fas fa-users"></i></div>
          <div class="nav-label">Users</div>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item" data-tab="withdrawals">
          <div class="nav-icon"><i class="fas fa-money-bill-wave"></i></div>
          <div class="nav-label">Withdrawals</div>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item" data-tab="referrals">
          <div class="nav-icon"><i class="fas fa-user-friends"></i></div>
          <div class="nav-label">Referrals</div>
        </a>
      </li>
      <li>
        <a href="#" class="nav-item" data-tab="settings">
          <div class="nav-icon"><i class="fas fa-cog"></i></div>
          <div class="nav-label">Settings</div>
        </a>
      </li>
    </ul>
  </nav>

  <!-- Confirm Modal -->
  <div class="modal-overlay" id="confirmModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Confirm Action</h3>
        <button class="modal-close" id="closeConfirmModal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div style="margin-bottom: 16px; color: var(--text-secondary);" id="confirmMessage">
        Are you sure?
      </div>
      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button class="btn btn-secondary" id="confirmCancelBtn">Cancel</button>
        <button class="btn btn-danger" id="confirmOkBtn">Delete</button>
      </div>
    </div>
  </div>

  <!-- User Details Modal -->
  <div class="modal-overlay" id="userModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">User Details</h3>
        <button class="modal-close" id="closeUserModal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="user-details" id="userDetailsContent">
        <!-- User details will be populated here -->
      </div>
    </div>
  </div>

  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <!-- Firebase Firestore -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <!-- Charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


  <script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
      // Replace with your Firebase project configuration
      apiKey: "AIzaSyBJdfIANk4BLn4PaQhH2n45kMRkvAZ-jM4",
      authDomain: "telebot-xhiclox.firebaseapp.com",
      projectId: "telebot-xhiclox",
      storageBucket: "telebot-xhiclox.firebasestorage.app",
      messagingSenderId: "246768497610",
      appId: "1:246768497610:web:69de7ab2ed0b7cdf145533"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Admin credentials
    const ADMIN_CREDENTIALS = {
      username: "admin",
      password: "admin123"
    };

    // DOM Elements
    const loginScreen = document.getElementById('loginScreen');
    const adminPanel = document.getElementById('adminPanel');
    const loginForm = document.getElementById('loginForm');
    const logoutBtn = document.getElementById('logoutBtn');
    const headerLogoutBtn = document.getElementById('headerLogoutBtn');
    const themeToggleBtn = document.getElementById('themeToggle');
    const refreshDataBtn = document.getElementById('refreshDataBtn');
    const pageTitle = document.getElementById('pageTitle');
    const toast = document.getElementById('toast');
    const userModal = document.getElementById('userModal');
    const closeUserModal = document.getElementById('closeUserModal');
    const userDetailsContent = document.getElementById('userDetailsContent');
    const adminSidebar = document.getElementById('adminSidebar');
    const mobileMenuButton = document.getElementById('mobileMenuButton');
    // Confirm modal
    const confirmModal = document.getElementById('confirmModal');
    const closeConfirmModal = document.getElementById('closeConfirmModal');
    const confirmMessage = document.getElementById('confirmMessage');
    const confirmOkBtn = document.getElementById('confirmOkBtn');
    const confirmCancelBtn = document.getElementById('confirmCancelBtn');
    let confirmResolve = null;

    // Tab navigation
    const navLinks = document.querySelectorAll('.nav-link');
    const tabContents = document.querySelectorAll('.tab-content');

    // Withdrawal tabs
    const withdrawalTabs = document.querySelectorAll('[data-withdrawal-tab]');
    const withdrawalTabContents = document.querySelectorAll('.withdrawal-tab-content');

    // Real-time listeners
    let usersListener = null;
    let withdrawalsListener = null;
    let settingsListener = null;
    let allUsersChartInstance = null;
    let referralChartInstance = null;
    let allUsersCache = [];

    // Check if user is already logged in
    function checkLoginStatus() {
      const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
      if (isLoggedIn) {
        loginScreen.style.display = 'none';
        adminPanel.style.display = 'flex';
        setupRealtimeListeners();
      }
    }

    // Show toast notification
    function showToast(message, type = 'success') {
      toast.textContent = message;
      toast.className = `toast show toast-${type}`;
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Login form submission
    loginForm.addEventListener('submit', function (e) {
      e.preventDefault();

      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
        localStorage.setItem('adminLoggedIn', 'true');
        loginScreen.style.display = 'none';
        adminPanel.style.display = 'flex';
        showToast('Login successful!', 'success');
        setupRealtimeListeners();
      } else {
        showToast('Invalid credentials!', 'error');
      }
    });

    // Logout functionality
    function performLogout() {
      localStorage.removeItem('adminLoggedIn');
      // Unsubscribe from real-time listeners
      if (usersListener) usersListener();
      if (withdrawalsListener) withdrawalsListener();
      if (settingsListener) settingsListener();

      adminPanel.style.display = 'none';
      loginScreen.style.display = 'flex';
      showToast('Logged out successfully', 'success');
    }
    logoutBtn.addEventListener('click', performLogout);
    headerLogoutBtn.addEventListener('click', performLogout);

    // Theme toggle
    themeToggleBtn.addEventListener('click', function () {
      document.body.classList.toggle('light-mode');
      document.body.classList.toggle('dark-mode');
      const isDarkMode = document.body.classList.contains('dark-mode');
      localStorage.setItem('adminDarkMode', isDarkMode ? 'dark' : 'light');
      themeToggleBtn.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    });

    // Refresh data button
    refreshDataBtn.addEventListener('click', function () {
      // Unsubscribe and resubscribe to refresh data
      if (usersListener) usersListener();
      if (withdrawalsListener) withdrawalsListener();
      setupRealtimeListeners();
      showToast('Data refreshed!', 'success');
    });

    // User modal functionality
    closeUserModal.addEventListener('click', function () {
      userModal.classList.remove('show');
    });

    // Confirm modal helpers
    function showConfirm(message, actionLabel = 'Delete') {
      confirmMessage.textContent = message;
      confirmOkBtn.textContent = actionLabel;
      confirmModal.classList.add('show');
      return new Promise(resolve => {
        confirmResolve = resolve;
      });
    }
    function hideConfirm() {
      confirmModal.classList.remove('show');
      confirmResolve = null;
    }
    closeConfirmModal.addEventListener('click', hideConfirm);
    confirmCancelBtn.addEventListener('click', () => { if (confirmResolve) confirmResolve(false); hideConfirm(); });
    confirmOkBtn.addEventListener('click', () => { if (confirmResolve) confirmResolve(true); hideConfirm(); });

    userModal.addEventListener('click', function (e) {
      if (e.target === userModal) {
        userModal.classList.remove('show');
      }
    });

    // Mobile menu toggle
    mobileMenuButton.addEventListener('click', function () {
      adminSidebar.classList.toggle('mobile-open');
      this.classList.toggle('active');
    });

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function (e) {
      if (window.innerWidth <= 768 &&
        adminSidebar.classList.contains('mobile-open') &&
        !adminSidebar.contains(e.target) &&
        e.target !== mobileMenuButton) {
        adminSidebar.classList.remove('mobile-open');
        mobileMenuButton.classList.remove('active');
      }
    });

    // Apply saved theme
    function applySavedTheme() {
      const savedTheme = localStorage.getItem('adminDarkMode') || 'dark';
      document.body.classList.toggle('dark-mode', savedTheme === 'dark');
      document.body.classList.toggle('light-mode', savedTheme === 'light');
      themeToggleBtn.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }

    // Check screen size and show/hide mobile menu button
    function checkScreenSize() {
      if (window.innerWidth <= 768) {
        mobileMenuButton.style.display = 'flex';
        adminSidebar.classList.remove('mobile-open');
        mobileMenuButton.classList.remove('active');
      } else {
        mobileMenuButton.style.display = 'none';
        adminSidebar.classList.remove('mobile-open');
        mobileMenuButton.classList.remove('active');
      }
    }

    // Tab navigation
    navLinks.forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();

        // Remove active class from all links and tabs
        navLinks.forEach(l => l.classList.remove('active'));
        tabContents.forEach(t => t.classList.remove('active'));

        // Add active class to clicked link
        this.classList.add('active');

        // Show corresponding tab
        const tabId = `${this.dataset.tab}Tab`;
        document.getElementById(tabId).classList.add('active');

        // Update page title
        pageTitle.textContent = this.querySelector('span').textContent;

        // On mobile, close the sidebar after selecting a tab
        if (window.innerWidth <= 768) {
          adminSidebar.classList.remove('mobile-open');
        }
      });
    });

    // Bottom nav wiring (mobile)
    document.querySelectorAll('.bottom-nav .nav-item').forEach(item => {
      item.addEventListener('click', function (e) {
        e.preventDefault();
        // Switch active state bottom nav
        document.querySelectorAll('.bottom-nav .nav-item').forEach(i => i.classList.remove('active'));
        this.classList.add('active');
        // Switch tabs (reuse same logic)
        const tabId = `${this.dataset.tab}Tab`;
        // Remove active classes
        navLinks.forEach(l => l.classList.remove('active'));
        tabContents.forEach(t => t.classList.remove('active'));
        // Activate corresponding sidebar nav if present
        const side = document.querySelector(`.nav-link[data-tab="${this.dataset.tab}"]`);
        if (side) side.classList.add('active');
        const target = document.getElementById(tabId);
        if (target) target.classList.add('active');
        pageTitle.textContent = this.querySelector('.nav-label').textContent;
      });
    });

    // Withdrawal tab navigation
    withdrawalTabs.forEach(tab => {
      tab.addEventListener('click', function () {
        // Remove active class from all tabs
        withdrawalTabs.forEach(t => t.classList.remove('active'));
        withdrawalTabContents.forEach(t => t.classList.remove('active'));

        // Add active class to clicked tab
        this.classList.add('active');

        // Show corresponding content
        const tabId = `${this.dataset.withdrawalTab}WithdrawalsTab`;
        const contentElement = document.getElementById(tabId);
        if (contentElement) {
          contentElement.classList.add('active');
        }
      });
    });

    // Setup real-time Firestore listeners
    function setupRealtimeListeners() {
      // Users collection listener
      usersListener = db.collection('users').onSnapshot(snapshot => {
        const users = [];
        snapshot.forEach(doc => {
          users.push({ id: doc.id, ...doc.data() });
        });

        allUsersCache = users; // cache for search filtering
        updateDashboardStats(users);
        applyUserSearchFilter();
        populateTopUsers(users);
        populateReferralData(users);
        renderDashboardCharts(users);
      }, error => {
        console.error('Users listener error:', error);
        showToast('Error loading users data', 'error');
      });

      // Withdrawals collection listener
      withdrawalsListener = db.collection('withdrawals').onSnapshot(snapshot => {
        const withdrawals = [];
        snapshot.forEach(doc => {
          withdrawals.push({ id: doc.id, ...doc.data() });
        });

        updateWithdrawalsTable(withdrawals);
        updateDashboardWithdrawalStats(withdrawals);
        populateRecentActivity(withdrawals);
      }, error => {
        console.error('Withdrawals listener error:', error);
        showToast('Error loading withdrawals data', 'error');
      });

      // Settings document listener
      settingsListener = db.collection('settings').doc('appSettings').onSnapshot(doc => {
        if (doc.exists) {
          const settings = doc.data();
          loadSettings(settings);
        } else {
          // Create default settings if they don't exist
          const defaultSettings = {
            pointsPerAd: 5,
            dailyAdLimit: 5000,
            minWithdrawalPoints: 400,
            referrerBonus: 10,
            refereeBonus: 5
          };
          db.collection('settings').doc('appSettings').set(defaultSettings);
          loadSettings(defaultSettings);
        }
      }, error => {
        console.error('Settings listener error:', error);
        showToast('Error loading settings', 'error');
      });
    }

    // Update dashboard stats
    function updateDashboardStats(users) {
      document.getElementById('totalUsers').textContent = users.length;
      document.getElementById('totalPoints').textContent = users.reduce((sum, user) => sum + (user.points || 0), 0);
      document.getElementById('totalAds').textContent = users.reduce((sum, user) => sum + (user.totalAdsWatchedLifetime || 0), 0);
    }

    // Render/update dashboard charts
    async function renderDashboardCharts(users) {
      const labels = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
      const totalAds = users.reduce((sum, u) => sum + (u.totalAdsWatchedLifetime || 0), 0);

      // Build referral series from realtime DB (referrals per day approximated from each user's joinDate of referrals if available)
      // Fallback: approximate from total referral counts evenly over last 7 days
      let referralSeries = new Array(7).fill(0);
      try {
        const now = new Date();
        const dayKey = (d) => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
        const last7Keys = [];
        for (let i = 6; i >= 0; i--) { const d = new Date(now); d.setDate(now.getDate()-i); last7Keys.push(dayKey(d)); }

        // If users contain a referralsDetail array with date info, aggregate by day
        let hasDetailed = false;
        const dailyRefMap = last7Keys.reduce((acc,k)=>{acc[k]=0;return acc;},{});
        // Prefer a dedicated 'referrals' collection with createdAt if available
        const referralsColExists = true; // attempt and fallback quickly if fails
        try {
          const since = new Date(); since.setDate(since.getDate()-6); since.setHours(0,0,0,0);
          const snap = await db.collection('referrals').where('createdAt','>=', since.toISOString()).get();
          if (!snap.empty) {
            snap.forEach(doc => {
              const r = doc.data();
              const d = r.createdAt ? new Date(r.createdAt) : null;
              if (d) {
                const k = dayKey(d);
                if (k in dailyRefMap) dailyRefMap[k] += 1;
              }
            });
            hasDetailed = true;
          }
        } catch (e) {
          // fallback to user-embedded details if present
        }
        if (!hasDetailed) {
          users.forEach(u => {
            if (Array.isArray(u.referralsDetail)) {
              hasDetailed = true;
              u.referralsDetail.forEach(r => {
                if (r && r.date) {
                  const d = new Date(r.date);
                  const k = dayKey(d);
                  if (k in dailyRefMap) dailyRefMap[k] += 1;
                }
              });
            }
          });
        }
        if (hasDetailed) {
          referralSeries = last7Keys.map(k => dailyRefMap[k] || 0);
        } else {
          const totalReferrals = users.reduce((sum, u) => sum + ((u.referrals && u.referrals.length) || 0), 0);
          const perDay = Math.max(0, Math.round(totalReferrals / 7));
          referralSeries = [perDay-1, perDay, perDay+1, perDay, perDay+2, perDay-1, perDay+1].map(v => Math.max(0, v));
        }
      } catch (e) {
        const totalReferrals = users.reduce((sum, u) => sum + ((u.referrals && u.referrals.length) || 0), 0);
        const perDay = Math.max(0, Math.round(totalReferrals / 7));
        referralSeries = [perDay-1, perDay, perDay+1, perDay, perDay+2, perDay-1, perDay+1].map(v => Math.max(0, v));
      }

      // All users activity series approximation
      const adsPerDay = Math.max(0, Math.round(totalAds / 7));
      const allUsersSeries = [adsPerDay-3, adsPerDay-1, adsPerDay, adsPerDay+2, adsPerDay-2, adsPerDay+3, adsPerDay+1].map(v => Math.max(0, v));

      const allUsersCtx = document.getElementById('allUsersChart');
      const referralCtx = document.getElementById('referralChart');

      if (allUsersCtx && window.Chart) {
        if (allUsersChartInstance) allUsersChartInstance.destroy();
        allUsersChartInstance = new Chart(allUsersCtx, {
          type: 'line',
          data: {
            labels,
            datasets: [{
              label: 'Ads Watched',
              data: allUsersSeries,
              fill: true,
              tension: 0.35,
              backgroundColor: 'rgba(126, 87, 194, 0.25)',
              borderColor: 'rgba(126, 87, 194, 1)',
              borderWidth: 2,
              pointBackgroundColor: 'rgba(94, 53, 177, 1)',
              pointBorderColor: '#fff',
              pointRadius: 3
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false }, tooltip: { enabled: true } },
            scales: {
              x: { grid: { display: false }, ticks: { color: getComputedStyle(document.body).getPropertyValue('--text-secondary') } },
              y: { grid: { color: 'rgba(160,174,192,0.2)' }, ticks: { color: getComputedStyle(document.body).getPropertyValue('--text-secondary') }, beginAtZero: true }
            },
            animation: { duration: 500 }
          }
        });
      }

      if (referralCtx && window.Chart) {
        if (referralChartInstance) referralChartInstance.destroy();
        referralChartInstance = new Chart(referralCtx, {
          type: 'bar',
          data: {
            labels,
            datasets: [{
              label: 'Referrals',
              data: referralSeries,
              backgroundColor: 'rgba(56, 161, 105, 0.35)',
              borderColor: 'rgba(56, 161, 105, 1)',
              borderWidth: 1.5,
              borderRadius: 6,
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false }, tooltip: { enabled: true } },
            scales: {
              x: { grid: { display: false }, ticks: { color: getComputedStyle(document.body).getPropertyValue('--text-secondary') } },
              y: { grid: { color: 'rgba(160,174,192,0.2)' }, ticks: { color: getComputedStyle(document.body).getPropertyValue('--text-secondary') }, beginAtZero: true }
            },
            animation: { duration: 500 }
          }
        });
      }

      // Trigger entrance animations
      document.querySelectorAll('.chart-card.animate-in').forEach(el => {
        requestAnimationFrame(() => el.classList.add('show'));
      });
    }

    // Update dashboard withdrawal stats
    function updateDashboardWithdrawalStats(withdrawals) {
      const pendingWithdrawals = withdrawals.filter(req => req.status === 'pending').length;
      document.getElementById('pendingWithdrawals').textContent = pendingWithdrawals;
    }

    // Update users table
    function updateUsersTable(users) {
      const usersTable = document.getElementById('usersTable');
      usersTable.innerHTML = '';

      users.forEach(user => {
        const row = document.createElement('tr');
        const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim() || 'User';
        row.innerHTML = `
          <td class="col-name"><span class="name-cell" onclick="showNamePopup(event, '${fullName.replace(/'/g, "&#39;")}')" title="${fullName}">${fullName}</span></td>
          <td>${user.points || 0}</td>
          <td class="col-ads">${user.totalAdsWatchedLifetime || 0}</td>
          <td><span class="badge badge-success">Active</span></td>
          <td class="col-actions">
            <div class="kebab-wrapper">
              <button class="kebab-btn" onclick="toggleKebabMenu(this)" aria-label="Actions"><i class="fas fa-ellipsis-vertical"></i></button>
              <div class="kebab-menu">
                <button class="kebab-item" onclick="closeAllKebabMenus(); viewUserDetails('${user.id}')"><i class="fas fa-eye"></i> View</button>
                <button class="kebab-item" onclick="closeAllKebabMenus(); banUser('${user.id}')"><i class="fas fa-ban"></i> Ban</button>
                <button class="kebab-item" onclick="closeAllKebabMenus(); deleteUser('${user.id}')"><i class="fas fa-trash"></i> Delete</button>
              </div>
            </div>
          </td>
        `;
        usersTable.appendChild(row);
      });
    }

    // Toggle kebab menu visibility
    function toggleKebabMenu(buttonEl) {
      const menu = buttonEl.nextElementSibling;
      const isOpen = menu.classList.contains('show');
      document.querySelectorAll('.kebab-menu.show').forEach(m => m.classList.remove('show'));
      if (!isOpen) menu.classList.add('show');
      // Close on outside click
      const onDocClick = (e) => {
        if (!menu.contains(e.target) && e.target !== buttonEl) {
          menu.classList.remove('show');
          document.removeEventListener('click', onDocClick);
        }
      };
      setTimeout(() => document.addEventListener('click', onDocClick), 0);
    }

    function closeAllKebabMenus() {
      document.querySelectorAll('.kebab-menu.show').forEach(m => m.classList.remove('show'));
    }

    // Show full name small popup near cursor
    function showNamePopup(evt, name) {
      // Remove any existing popup
      document.querySelectorAll('.name-popup').forEach(el => el.remove());
      const popup = document.createElement('div');
      popup.className = 'name-popup';
      popup.textContent = name;
      document.body.appendChild(popup);
      const padding = 8;
      const x = Math.min(window.innerWidth - popup.offsetWidth - padding, evt.clientX + 12);
      const y = Math.min(window.innerHeight - popup.offsetHeight - padding, evt.clientY + 12);
      popup.style.left = x + 'px';
      popup.style.top = y + 'px';
      setTimeout(() => {
        const remove = () => { popup.remove(); document.removeEventListener('click', remove); };
        document.addEventListener('click', remove);
      }, 0);
    }

    // Search filtering for users
    const userSearchInput = document.getElementById('userSearch');
    function applyUserSearchFilter() {
      if (!Array.isArray(allUsersCache)) return;
      const q = (userSearchInput?.value || '').trim().toLowerCase();
      let list = allUsersCache;
      if (q) {
        list = allUsersCache.filter(u => {
          const name = `${u.firstName || ''} ${u.lastName || ''}`.toLowerCase();
          return (
            u.id?.toLowerCase().includes(q) ||
            name.includes(q) ||
            String(u.points || 0).includes(q) ||
            String(u.totalAdsWatchedLifetime || 0).includes(q)
          );
        });
      }
      updateUsersTable(list);
    }
    // Debounce helper
    function debounce(fn, wait) {
      let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), wait); };
    }
    if (userSearchInput) {
      userSearchInput.addEventListener('input', debounce(applyUserSearchFilter, 200));
    }

    // Update withdrawals table
    function updateWithdrawalsTable(withdrawals) {
      const pendingTable = document.getElementById('pendingWithdrawalsTable');
      const approvedTable = document.getElementById('approvedWithdrawalsTable');
      const rejectedTable = document.getElementById('rejectedWithdrawalsTable');

      pendingTable.innerHTML = '';
      approvedTable.innerHTML = '';
      rejectedTable.innerHTML = '';

      withdrawals.forEach(request => {
        const row = document.createElement('tr');

        if (request.status === 'pending') {
          row.innerHTML = `
            <td>${request.id}</td>
            <td>${request.userName || 'Unknown'}</td>
            <td>${request.amount} points</td>
            <td>${request.method}</td>
            <td>${request.account || 'N/A'}</td>
            <td>${new Date(request.requestDate).toLocaleDateString()}</td>
            <td>
              <button class="btn btn-sm btn-success" onclick="approveWithdrawal('${request.id}')">
                <i class="fas fa-check"></i> Approve
              </button>
              <button class="btn btn-sm btn-danger" onclick="rejectWithdrawal('${request.id}')">
                <i class="fas fa-times"></i> Reject
              </button>
              <button class="btn btn-sm btn-danger" onclick="deleteWithdrawal('${request.id}')">
                <i class="fas fa-trash"></i> Delete
              </button>
            </td>
          `;
          pendingTable.appendChild(row);
        } else if (request.status === 'approved') {
          row.innerHTML = `
            <td>${request.id}</td>
            <td>${request.userName || 'Unknown'}</td>
            <td>${request.amount} points</td>
            <td>${request.method}</td>
            <td>${request.account || 'N/A'}</td>
            <td>${new Date(request.approvedDate).toLocaleDateString()}</td>
            <td>
              <button class="btn btn-sm btn-danger" onclick="deleteWithdrawal('${request.id}')">
                <i class="fas fa-trash"></i> Delete
              </button>
            </td>
          `;
          approvedTable.appendChild(row);
        } else if (request.status === 'rejected') {
          row.innerHTML = `
            <td>${request.id}</td>
            <td>${request.userName || 'Unknown'}</td>
            <td>${request.amount} points</td>
            <td>${request.method}</td>
            <td>${request.rejectionReason || 'No reason provided'}</td>
            <td>${new Date(request.rejectedDate).toLocaleDateString()}</td>
            <td>
              <button class="btn btn-sm btn-danger" onclick="deleteWithdrawal('${request.id}')">
                <i class="fas fa-trash"></i> Delete
              </button>
            </td>
          `;
          rejectedTable.appendChild(row);
        }
      });
    }

    // Populate referral data
    function populateReferralData(users) {
      const totalReferrals = users.reduce((sum, user) => sum + (user.referrals ? user.referrals.length : 0), 0);
      const totalBonusGiven = totalReferrals * 10; // Assuming 10 points per referral
      const conversionRate = users.length > 0 ? Math.round((totalReferrals / users.length) * 100) : 0;

      document.getElementById('totalReferrals').textContent = totalReferrals;
      document.getElementById('totalBonusGiven').textContent = totalBonusGiven;
      document.getElementById('conversionRate').textContent = `${conversionRate}%`;

      // Populate top referrers
      const topReferrers = users
        .filter(user => user.referrals && user.referrals.length > 0)
        .sort((a, b) => (b.referrals.length - a.referrals.length))
        .slice(0, 10);

      const topReferrersTable = document.getElementById('topReferrersTable');
      topReferrersTable.innerHTML = '';

      topReferrers.forEach(user => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${user.firstName || ''} ${user.lastName || ''}</td>
          <td>${user.referrals.length}</td>
          <td>${user.referrals.length * 10} points</td>
        `;
        topReferrersTable.appendChild(row);
      });
    }

    // Populate recent activity
    function populateRecentActivity(withdrawals) {
      const activityTable = document.getElementById('recentActivityTable');
      activityTable.innerHTML = '';

      // Get recent withdrawals (last 10)
      const recentWithdrawals = withdrawals
        .sort((a, b) => new Date(b.requestDate) - new Date(a.requestDate))
        .slice(0, 10);

      recentWithdrawals.forEach(withdrawal => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${withdrawal.userName || 'Unknown'}</td>
          <td>Withdrawal Request</td>
          <td>${withdrawal.amount} points via ${withdrawal.method}</td>
          <td>${new Date(withdrawal.requestDate).toLocaleDateString()}</td>
        `;
        activityTable.appendChild(row);
      });
    }

    // Populate top users
    function populateTopUsers(users) {
      const topUsersTable = document.getElementById('topUsersTable');
      topUsersTable.innerHTML = '';

      // Sort users by points and get top 10
      const topUsers = users
        .sort((a, b) => (b.points || 0) - (a.points || 0))
        .slice(0, 10);

      topUsers.forEach((user, index) => {
        const row = document.createElement('tr');
        const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim() || 'User';
        row.innerHTML = `
          <td>#${index + 1}</td>
          <td class="col-name"><span class="name-cell" onclick=\"showNamePopup(event, '${fullName.replace(/'/g, "&#39;")}')\" title=\"${fullName}\">${fullName}</span></td>
          <td>${user.points || 0}</td>
          <td class="col-ads">${user.totalAdsWatchedLifetime || 0}</td>
          <td>${user.referrals ? user.referrals.length : 0}</td>
        `;
        topUsersTable.appendChild(row);
      });
    }

    // Load application settings
    function loadSettings(settings) {
      document.getElementById('pointsPerAd').value = settings.pointsPerAd || 5;
      document.getElementById('dailyAdLimit').value = settings.dailyAdLimit || 5000;
      document.getElementById('minWithdrawalPoints').value = settings.minWithdrawalPoints || 400;
      document.getElementById('referrerBonus').value = settings.referrerBonus || 10;
      document.getElementById('refereeBonus').value = settings.refereeBonus || 5;
    }

    // Save application settings
    document.getElementById('appSettingsForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const settings = {
        pointsPerAd: parseInt(document.getElementById('pointsPerAd').value),
        dailyAdLimit: parseInt(document.getElementById('dailyAdLimit').value),
        minWithdrawalPoints: parseInt(document.getElementById('minWithdrawalPoints').value),
        referrerBonus: parseInt(document.getElementById('referrerBonus').value),
        refereeBonus: parseInt(document.getElementById('refereeBonus').value)
      };

      db.collection('settings').doc('appSettings').set(settings)
        .then(() => {
          showToast('Settings saved successfully!', 'success');
        })
        .catch(error => {
          console.error('Error saving settings:', error);
          showToast('Error saving settings', 'error');
        });
    });

    // Approve withdrawal
    function approveWithdrawal(requestId) {
      db.collection('withdrawals').doc(requestId).update({
        status: 'approved',
        approvedDate: new Date().toISOString()
      })
        .then(() => {
          showToast('Withdrawal approved!', 'success');
        })
        .catch(error => {
          console.error('Error approving withdrawal:', error);
          showToast('Error approving withdrawal', 'error');
        });
    }

    // Reject withdrawal
    function rejectWithdrawal(requestId) {
      const reason = prompt('Enter rejection reason:');
      if (reason === null) return; // User cancelled

      db.collection('withdrawals').doc(requestId).update({
        status: 'rejected',
        rejectionReason: reason,
        rejectedDate: new Date().toISOString()
      })
        .then(() => {
          showToast('Withdrawal rejected!', 'success');
        })
        .catch(error => {
          console.error('Error rejecting withdrawal:', error);
          showToast('Error rejecting withdrawal', 'error');
        });
    }

    // View user details
    function viewUserDetails(userId) {
      db.collection('users').doc(userId).get()
        .then(doc => {
          if (doc.exists) {
            const user = { id: doc.id, ...doc.data() };
            showUserModal(user);
          } else {
            showToast('User not found!', 'error');
          }
        })
        .catch(error => {
          console.error('Error getting user:', error);
          showToast('Error loading user details', 'error');
        });
    }

    // Show user details modal
    function showUserModal(user) {
      userDetailsContent.innerHTML = `
        <img src="${user.photoUrl || 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png'}" 
             alt="User Avatar" class="user-avatar-large">

        <div class="detail-row" style="justify-content:center; border-bottom: none; padding-top: 0;">
          <span class="detail-value" style="font-weight:600;">${user.firstName || ''} ${user.lastName || ''}</span>
        </div>

        <div class="user-stats-grid">
          <div class="user-stat-card">
            <div class="user-stat-value">${user.points || 0}</div>
            <div class="user-stat-label">Points</div>
          </div>
          <div class="user-stat-card">
            <div class="user-stat-value">${user.totalAdsWatchedLifetime || 0}</div>
            <div class="user-stat-label">Ads Watched</div>
          </div>
          <div class="user-stat-card">
            <div class="user-stat-value">${user.adsWatchedToday || 0}</div>
            <div class="user-stat-label">Today's Ads</div>
          </div>
          <div class="user-stat-card">
            <div class="user-stat-value">${user.referrals ? user.referrals.length : 0}</div>
            <div class="user-stat-label">Referrals</div>
          </div>
        </div>
        
        
        <div class="detail-row">
          <span class="detail-label">User ID:</span>
          <span class="detail-value">${user.id}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Telegram ID:</span>
          <span class="detail-value">${user.telegramId || 'N/A'}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Referral Code:</span>
          <span class="detail-value">${user.referralCode || 'N/A'}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Referred By:</span>
          <span class="detail-value">${user.referredBy || 'None'}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Join Date:</span>
          <span class="detail-value">${new Date(user.joinDate).toLocaleDateString()}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Last Active:</span>
          <span class="detail-value">${new Date(user.lastActive).toLocaleDateString()}</span>
        </div>
      `;

      userModal.classList.add('show');
    }

    // Ban user
    function banUser(userId) {
      if (confirm('Are you sure you want to ban this user?')) {
        db.collection('users').doc(userId).update({
          status: 'banned',
          bannedDate: new Date().toISOString()
        })
          .then(() => {
            showToast('User banned successfully!', 'success');
          })
          .catch(error => {
            console.error('Error banning user:', error);
            showToast('Error banning user', 'error');
          });
      }
    }

    // Delete user
    async function deleteUser(userId) {
      const ok = await showConfirm('Are you sure you want to delete this user? This will remove the user permanently.', 'Delete');
      if (!ok) return;
      db.collection('users').doc(userId).delete()
        .then(() => {
          showToast('User deleted permanently!', 'success');
        })
        .catch(error => {
          console.error('Error deleting user:', error);
          showToast('Error deleting user', 'error');
        });
    }

    // Delete withdrawal
    async function deleteWithdrawal(requestId) {
      const ok = await showConfirm('Are you sure you want to delete this withdrawal? This will remove the record permanently.', 'Delete');
      if (!ok) return;
      db.collection('withdrawals').doc(requestId).delete()
        .then(() => {
          showToast('Withdrawal deleted permanently!', 'success');
        })
        .catch(error => {
          console.error('Error deleting withdrawal:', error);
          showToast('Error deleting withdrawal', 'error');
        });
    }

    // Export data
    document.getElementById('exportDataBtn').addEventListener('click', function () {
      Promise.all([
        db.collection('users').get(),
        db.collection('withdrawals').get(),
        db.collection('settings').doc('appSettings').get()
      ])
        .then(([usersSnapshot, withdrawalsSnapshot, settingsDoc]) => {
          const users = [];
          usersSnapshot.forEach(doc => {
            users.push({ id: doc.id, ...doc.data() });
          });

          const withdrawals = [];
          withdrawalsSnapshot.forEach(doc => {
            withdrawals.push({ id: doc.id, ...doc.data() });
          });

          const settings = settingsDoc.exists ? settingsDoc.data() : {};

          const data = {
            users,
            withdrawals,
            settings,
            exportDate: new Date().toISOString()
          };

          const dataStr = JSON.stringify(data, null, 2);
          const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);

          const exportFileDefaultName = 'adlancer-data.json';

          const linkElement = document.createElement('a');
          linkElement.setAttribute('href', dataUri);
          linkElement.setAttribute('download', exportFileDefaultName);
          linkElement.click();

          showToast('Data exported successfully!', 'success');
        })
        .catch(error => {
          console.error('Error exporting data:', error);
          showToast('Error exporting data', 'error');
        });
    });

    // Reset data
    document.getElementById('resetDataBtn').addEventListener('click', function () {
      if (confirm('WARNING: This will reset ALL data. Are you absolutely sure?')) {
        // This is a dangerous operation - in a real app, you'd want additional safeguards
        const batch = db.batch();

        // Delete all users
        db.collection('users').get().then(snapshot => {
          snapshot.forEach(doc => {
            batch.delete(doc.ref);
          });

          // Delete all withdrawals
          return db.collection('withdrawals').get();
        })
          .then(snapshot => {
            snapshot.forEach(doc => {
              batch.delete(doc.ref);
            });

            // Reset settings to defaults
            const defaultSettings = {
              pointsPerAd: 5,
              dailyAdLimit: 5000,
              minWithdrawalPoints: 400,
              referrerBonus: 10,
              refereeBonus: 5
            };

            const settingsRef = db.collection('settings').doc('appSettings');
            batch.set(settingsRef, defaultSettings);

            // Commit the batch
            return batch.commit();
          })
          .then(() => {
            showToast('All data has been reset!', 'success');
          })
          .catch(error => {
            console.error('Error resetting data:', error);
            showToast('Error resetting data', 'error');
          });
      }
    });

    // Initialize admin panel
    function initAdminPanel() {
      checkLoginStatus();
      applySavedTheme();
      checkScreenSize();
      window.addEventListener('resize', checkScreenSize);
    }

    // Run initialization when DOM is loaded
    document.addEventListener('DOMContentLoaded', initAdminPanel);
  </script>
</body>

</html>




